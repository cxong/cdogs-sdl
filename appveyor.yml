branches:
  except:
    - gh-pages

environment:
  CTEST_OUTPUT_ON_FAILURE: 1

platform:
  - x86

install:
  # CMake refuses to generate MinGW Makefiles if sh.exe is in the Path
  - ps: Get-Command sh.exe -All | Remove-Item

before_build:
  - g++ --version
  - mingw32-make --version
  - cmake --version
  - if "%APPVEYOR_REPO_TAG%"=="true" (set CMAKE_BUILD_TYPE=Release) else (set CMAKE_BUILD_TYPE=Debug)
  - cmake -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=%CMAKE_BUILD_TYPE% -D CMAKE_C_COMPILER=mingw32-gcc.exe -D CMAKE_MAKE_PROGRAM=mingw32-make.exe .

build_script:
  - mingw32-make

after_build:
  - mingw32-make test
